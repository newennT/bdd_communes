{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
    <h1>{% trans %}Accueil{% endtrans %}</h1>

    <div id="map" style="height: 600px; width: 800px;"></div>
    <form id="filter-form" method="get">
        <label for="pays">Filtrer par pays :</label>
        <select name="pays" id="pays">
            <option value="">-- Tous les pays --</option>
            {% for item in pays %}
                <option value="{{ item.id }}" {% if currentFilters.pays == item.id %}selected{% endif %}>{{ item.nomFrancais }}</option>
            {% endfor %}
        </select>

        <label for="eveche">Filtrer par évêché :</label>
        <select name="eveche" id="eveche">
            <option value="">-- Tous les évêchés --</option>
            {% for eveche in eveches %}
                <option value="{{ eveche.id }}" {% if currentFilters.eveche == eveche.id %}selected{% endif %}>{{ eveche.nomFrancais }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filtrer</button>
    </form>

    <h2>Liste des communes</h2>

    <ul>
        {% for commune in communesPagination %}
            <a href="{{ path('app_commune_show', {'id': commune.id, '_locale': app.request.locale}) }}"><li>{{ commune.nomFrancais }} / {{ commune.nomBreton }} / {{ commune.nomGallo }} ({{ commune.code }})</li></a>
        {% else %}
            Aucune commune à afficher
        {% endfor %}
    </ul>

     {{ pagerfanta(communesPagination, {'routeParams': app.request.query.all}) }}

    <h2>Listes des évéchés</h2>
    <ul>
        {% for eveche in eveches %}
            <a href="{{ path('app_eveche_show', {'id': eveche.id, '_locale': app.request.locale}) }}"><li>{{ eveche.nomFrancais }} / {{ eveche.nomBreton }} / {{ eveche.nomGallo }}</li></a>
        {% else %}
            Aucun évéché enregistré
        {% endfor %}
    </ul>

    <h2>Listes des pays</h2>
    <ul>
        {% for item in pays %}
            <a href="{{ path('app_pays_show', {'id': item.id, '_locale': app.request.locale}) }}"><li>{{ item.nomFrancais }} / {{ item.nomBreton }} / {{ item.nomGallo }}</li></a>
        {% else %}
            Aucun pays enregistré
        {% endfor %}
    </ul>

{% endblock %}

{% block javascripts %}

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>

    document.addEventListener('DOMContentLoaded', function () {
        let nbHabitants;
        let color;
        let radius;

        function getColorByPopulation(nbHabitants) {
            return '#ff0000';
        }

        function getRadius(nbHabitants){
            if (nbHabitants <= 1000) {
                return 2;
            } else if (nbHabitants <= 2500){
                return 4;
            } else if (nbHabitants <= 5000){
                return 8;
            } else if (nbHabitants <= 10000){
                return 12;
            } else if (nbHabitants <= 50000){
                return 16;
            } else if (nbHabitants <= 100000){
                return 20;
            } else {
                return 24;
            }
        }

        var map = L.map('map').setView([47.9, -2.7 ], 8);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);


        {% for commune in communes %}

        nbHabitants = {{ commune.habitants }} ;
        color = getColorByPopulation(nbHabitants);
        radius = getRadius(nbHabitants);

        L.circle([{{ commune.latitude }}, {{ commune.longitude }}], {
                        color: '#000000',
                        weight: 1,
                        fillColor: color,
                        radius: radius*220,
                        fillOpacity: 0.5
                    })
            .addTo(map)
            .bindPopup('<strong>{{ commune.nomFrancais|escape("html") }}</strong>') 
            .on('click', function () {
                circle.openPopup();  
            });
       

        {% endfor %}
     });
</script>

{% endblock %}